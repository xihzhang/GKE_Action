# Docker image configuration
image:
  registry: $IMAGE_REGISTRY/auth
  # Configure imagePullSecrets if docker registry requires authentication
  # https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#registry-secret-existing-credentials
  imagePullSecrets:
    - name: pullsecret
  pullPolicy: IfNotPresent
COLOR: blue
postgres:
  deploy: false
  secret:
    name_override:
    create: true
  configmap:
    name_override:
    create: true
  image: postgres:11-alpine
  # REQUIRED FIELDS:
  username: gauth_pg_username
  password: gauth_pg_password
  db: gauth
  host: POSTGRES_ADDR
  port: 5432
redis:
  deploy: false
  secret:
    name_override: gauth-redis
    create: true
  configmap:
    name_override:
    create: true
  image: redis:5-stretch
  cluster_nodes: infra-redis-redis-cluster-headless.infra.svc.cluster.local:6379
  use_tls: false
  # REDIS AUTH
  password_required: true
  password: gauth_redis_password
services:
  secrets:
    useSecretProviderClass: false
    aadpodidbinding: gauth-identity
    secretProviderClassNames:
      jks_keyvault: keyvault-gauth-jks-keyvault
      jks_credentials: keyvault-gauth-jks-credentials
      admin_user: keyvault-gauth-admin-user
      pg_user: keyvault-gauth-pg-user
      redis_password: keyvault-gauth-redis-password
      client_credentials: keyvault-gauth-client-credentials
      consul_token: keyvault-consul-consul-gauth-token
  # Number of pod replicas, recommended to be N+1
  replicas: 2
  location: /USW1
  db:
    init: true
    poolSize: 3
    poolCheckoutTimeout: 3000
    ssl: disable
  secret:
    name_override:
    create: true
    # REQUIRED FIELDS:
    admin_username: gauth_admin_username
    admin_password: gauth_admin_password
    client_id: gauth_gws_client_id
    client_secret: gauth_gws_client_secret
  auth_ui:
    # Pod resources requests and limits
    resources:
      limits:
        cpu: 100m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 512Mi
  auth:
    jks:
      enabled: true
      sso:
        enabled: true
      secret:
        create: true

      # Convert keystore.jks file content to base64 ( cat keystore.jks | base64 ) and put the output here
      keyStore: jksStorage.jks

      keyStoreFileData: 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
      #keyStoreFileData: MIIKoQIBAzCCCloGCSqGSIb3DQEHAaCCCksEggpHMIIKQzCCBboGCSqGSIb3DQEHAaCCBasEggWnMIIFozCCBZ8GCyqGSIb3DQEMCgECoIIFQDCCBTwwZgYJKoZIhvcNAQUNMFkwOAYJKoZIhvcNAQUMMCsEFFHbUo27apU9L0dR8yoQmyXrXuJ+AgInEAIBIDAMBggqhkiG9w0CCQUAMB0GCWCGSAFlAwQBKgQQ9AY2XEvSwQS3Aj9A508f+ASCBNBWTlyGYZOnle8KNKy1okULJW6k29vMjbOmNUSEaYYe5FvP8cf7kKrCimUT95fU5kygr/gRNqWaWowH9sa2Gicw4Rf0+faIJ/MHcPb2Uwcj95jJDSvdjdkWW9t+aFBKaMwMRvfWVITrBxfUlU2KLkOsg87KdzRVeCfqTbkAKj6DRIWalYUMPOagG/+yDDhlEIacZFC3C5kfdU+Y5GDAJsO6lyPnlSHqBy3by5W8DWt9ONwFZEGwG5/NNqN9rBRgcWMHjya6jwardD7A/ngPr5IckY6IwBAvrihnJZparKVGo6t/LQ7/7fAstw6xf/07g5YnJouGKZdYbYeA0eHSfu+Cy9lT0Owe/N/YZQ8Ul6aPtmi+KV3zNapKWoR/hSp0eODkGehvb44RYPvh8i+3Mie2FsidhfkoKAXk2B85+lEeZSt0uZxGRuVgNNrxyHRGGlR/g8zb1LeJETSZzl3KNW1kP7urKGl0t0tgj2Kufm5SkUJlGQmTcpk/KArCVjJCb8iLiH7jErltBf0HGdQnjsst+P8yQFYsD7kEDj7+fUlZexWfYZk+xWs1vvLcN1aBMDnTWjtntPVulZ0aKAYHvK7aq1uRKB34UzTa0qvJqZvrcvqxBqTLhReJh05pgEv8wtB2+FciCpQL0z3S0MgUb5u8cJt3v9+c65cJSbNcIndtou2CqkRU5GVtzvAm+R2pHdl7mL2FxwRVC0ycy9v889XhsNcq5LGQBcSBGUAWz3Gns51rN+XquMS9bsriMORvRdwhwBvRVojueCR3BrAvzniYDKAXJWYutjX36AgePvPru6kVne5DPhvnfQMwENRd6X83GBk4+upR5Z12gmpoy2ptowGgq9VXgXrAbYLIeaAYDO6y0YQxujHNjfACxWv4N/p02qHDR8XnD0ks/9faUZ8ISyOvXq+NaMEm33TfNAWPO87HJA62N7Gn0HEmitaBLFOKL5sQ8msJL2jdKx9X2Hdta3fyVELRg2R4BkLmM/LBFNuYaPFK4wICu66VISKPJLFjFeJTKArrjX0Y8/V7jtUra/A0zdkteh+AJSgICdOzxUA5LqXi8etYoYOgezWVCgWWiAw5g8AYmu0fgsNoQ7YXMMBrn90Q24ycKjSMh8ZVqtKL7fE2sRp0+B53tEC/lAmpn5jdEft0vHDVpTMZJh+YQsub3C66v8HLAtIsHF0ER5I0t1ptlytLtu84qpJNFtCs/ZL9upadjRAelFt3x37V7TO7LZcTWYkavHr1+hgDv6FpC1BMyhZaLHOOD/aVoygsmrmRK8aEjmoZXpXpr8CENw1+o5NjZJUl21DT3VO8X0Kbhp0a6Dui2vjdVH8tp3ddvXsHuxozyR+mdYYOO98B/Iwgw2mvjQs8WD7l4SHVZEDmAJovsTQrKB6EYjyNeO6QOoweg84uheiqCF6Jw7ECowICkLsiYEOXkOlXJF/foWkw/KGr5YbS2ztNFvaBAlp6I11scjhGMAdOWPdXOcE+eGTBQs77+9Gz2aPLZ7G7ywYMYp7+r/UN5mP4josaGokG9x0RlszBfRdQ7mPVOGJjbLiDkkmK8tekpAb5hUTRPSme7uilqkzX3ZgHU53M1Ro5y1XqhNwHwMyPPBwno6/UAzLVrLhaqnxM+t34zj4MZzFMMCcGCSqGSIb3DQEJFDEaHhgAZwB3AHMALQBhAHUAdABoAC0AawBlAHkwIQYJKoZIhvcNAQkVMRQEElRpbWUgMTY1NzcyMjIzOTI3NjCCBIEGCSqGSIb3DQEHBqCCBHIwggRuAgEAMIIEZwYJKoZIhvcNAQcBMGYGCSqGSIb3DQEFDTBZMDgGCSqGSIb3DQEFDDArBBThm9QsyFF+rFvM2epSnlR3qKfAXgICJxACASAwDAYIKoZIhvcNAgkFADAdBglghkgBZQMEASoEELOahnMek+CIInCoyqSy8+GAggPwIU/N/VtO+9L2CACJPl7rItJQw7gFh3l2OCbpwcO6CR63dJF5N46i1k0R7jPzKrqzzgxyZpwuZGkuS4IfjhpSVE8pLPcIeGfFdQQrgPaBWYxZ0EsbNLHpBN2OtkYpwoICZvccmGruZbnXXYydL+8NkIadjRD3aFM41jXetYWb9SSlgSuvfSWyc1N20SuqJmoHf3D1RVX4U9pOdisnZmilLVsicQafn1ZSCh7KQ2ut3dv5YRgXiBplq5rQMtSKV1/4NUDIXVQGOLsGL2iKfjv8fYcdZVu8ajmPdccZ6DWqngOW7eVdZ6TR4saCF/kiMBqdSb25AlKBeEhbKplvekVeIQV1HdU7I8hFVo4iaUFsl9Sv7zrupHBrcD1kSwM8lz6tAwOVZX+AqQOqTGaWU80izn3KXoc3jGNyzzyZzzZD+WkhZEop7bRfZ4YVzzFOvj1jj0L46lREaP6+F4090vHVe0vvN7uZucvrPF/ECJDYyPIsoZLld21rIddlCL1j8kxinGbuIXkvO+m2HRxqcwL/qdzBh4atGlhZD8Y704l7slDYRy3X2vmYlkiAqwhEnnOt3DapI4VPgiVjUyor/HMSZb/foL9Uj5MwhaO76etzm9dlBtiYqkBIa38VGd6ZTxdQpfNIZX00xo7/1lf/qKcRHrQZnANNkygVw0IIMqNOcnlXe9j4U7JKFYMeZ2gAtzjfTgJ4LDTm8j3Fv1C8nXw1QtsHlRDeXcqa30GreUeVJB2qhjHcTPHSplXeqFLrUDdSYuYq1T1YNSE7aiTEgfVS9tMcjSy2pTb63pmkNDzNlSnlfkduu+t19qA2pyJEpedceUk8Y0uqnN4XaUQnj/0iFTWK5CeQ9UD9Sxce3tF3gEFO5PWPbD+McivEGW9bjLZdcYCLQY8XQx1NJ1fvL4Muhw6AjyT5Lt1w5exaW9wPn3LBvXnGKa6VKHXXmKRGbvHlyLasimrnqjho4O6A+/KZZ4gaw2qYGdJyWc3dx7MRLnTmZJBXgV45igtFoCgaP2HIjH1kLUhrlhB5ZQmEgfgcLIWKygfT7lrWB+O//zBS0uQrRsLZpNl1/Px7B9nJ3uz3A6VzYt6BdrTVRXctV4uPFHD1mbia8NiTfApeuG9LIALCGOeqJbKQP2bpNly8SRbLVPgMCxH87HmSsOKwPfcgKMOA/bwcwwJzLM19YhZspcUIiuMwWxyHMx4jdRq/QCzL+kB7bcOcm+C8qvkBSLCYMsZYnMwoCx1YzafdNnkoSA/5UKFvzpVBkaRQv+dKTsbLWsGDoOkUCLT0RuqH6GJLbyQDL9Ad2G/2L+DRE2+oVXv37EL7LpiuZ4CvvN1D1OxDMD4wITAJBgUrDgMCGgUABBQZK3TsB0ZG+Vz/2COqkbHFi4utGAQURzwIFMeSccl9vrk3bhQEO6B3IXACAwGGoA==
      
      # Keystore password
      keyStorePassword: gauth_jks_keyStorePassword
      # SSL key alias
      keyAlias: gws-auth-key
      # SSL key password
      keyPassword: gauth_jks_keyPassword
    # Number of pod replicas, recommended to be N+1, defaults to services.replica if empty
    replicas:
    # Pod resources requests and limits
    resources:
      requests:
        cpu: 200m
        memory: 1Gi
      limits:
        cpu: 200m
        memory: 2Gi
    # readiness probe.
    # To disable readinessProbe - set readinessProbe: {}
    readinessProbe:
      httpGet:
        path: /health
        port: management
      initialDelaySeconds: 30
      timeoutSeconds: 3
      periodSeconds: 10
    # liveness probe
    # To disable livenessProbe - set livenessProbe: {}
    livenessProbe:
      httpGet:
        path: /health
        port: management
      initialDelaySeconds: 120
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 3
      failureThreshold: 3
  environment:
    # Number of pod replicas, recommended to be N+1, defaults to services.replica if empty
    replicas:
    force_writable: true
    # Pod resources requests and limits
    resources:
      requests:
        cpu: 200m
        memory: 1Gi
      limits:
        cpu: 200m
        memory: 1Gi
    # readiness probe.
    # To disable readinessProbe - set readinessProbe: {}
    readinessProbe:
      httpGet:
        path: /health
        port: management
      initialDelaySeconds: 30
      timeoutSeconds: 3
      periodSeconds: 10
    # liveness probe
    # To disable livenessProbe - set livenessProbe: {}
    livenessProbe:
      httpGet:
        path: /health
        port: management
      initialDelaySeconds: 120
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 3
      failureThreshold: 3
# Optional Deployment/ReplicaSet parameters
optional:
  # https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass
  priorityClassName: ''
  #  https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContext: {}
  #  https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
  nodeSelector: {}
  #  https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
  tolerations: []
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - podAffinityTerm:
            labelSelector:
              matchLabels:
                gauth: '{{ .gauth }}'
                app.kubernetes.io/name: '{{ include "auth.name" . }}'
                app.kubernetes.io/instance: '{{ .Release.Name }}'
            topologyKey: failure-domain.beta.kubernetes.io/zone
          weight: 100
# https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 10
      maxUnavailable: 0
# Ingress config
# tps://kubernetes.io/docs/concepts/services-networking/ingress/
ingress:
  enabled: true
  # Host that will be used by ingress.
  # Applies to all inbound traffic through the host specified
  frontend: gauth.${DOMAIN}
  annotations:
    # Default annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
  # HTTPS configuration
  tls_enabled: true
  tls:
    - hosts:
        - gauth.${DOMAIN}
      secretName: letsencrypt
# Internal  config
# tps://kubernetes.io/docs/concepts/services-networking/ingress/
internal_ingress:
  enabled: true
  # Host that will be used by ingress.
  # Applies to all inbound traffic through the host specified
  frontend: gauth-int.${DOMAIN}
  annotations:
    # Default annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
  # HTTPS configuration
  tls_enabled: true
  tls:
    - hosts:
        - gauth-int.${DOMAIN}
      #secretName: letsencrypt
#monitoring:
  # Deploy ServiceMonitor
  #enabled: true
  # Metrics Scraping Interval
  #interval: 15s
  # Create ConfigMap with Grafana Dashboards
  #dashboards: true
  # Create PrometheusRule k8s object with alarm definitions
  #alarms: false
  # Create rules with CRITICAL severity for Pager Duty integration.
  # `false` will change severity to HIGH (email notifications)
  #pagerduty: true
services:
  auth:
    replicas: 1
  environment:
    replicas: 1
  auth_ui:
    replicas: 1
pod_autoscaler:
  auth:
    enabled: false
    metrics:
      - type: Resource
        resource:
          name: cpu
          target:
            type: Utilization
            averageUtilization: 350
  environment:
    enabled: false
    metrics:
      - type: Resource
        resource:
          name: cpu
          target:
            type: Utilization
            averageUtilization: 350
